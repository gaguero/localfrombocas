<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panam√° - Provincias Expandibles - Local From Bocas</title>
    <meta name="description" content="Explora la diversidad de Panam√°: 10 provincias y 3 comarcas ind√≠genas. Mapa interactivo donde las provincias se expanden al hacer hover.">
    <meta name="keywords" content="Panam√°, provincias Panam√°, comarcas ind√≠genas, geograf√≠a Panam√°, cultura paname√±a">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            overflow: hidden;
            height: 100vh;
        }

        /* Mapa a pantalla completa */
        .fullscreen-map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0F5B55 0%, #2C8AC6 100%);
            z-index: 1;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-svg {
            width: 90%;
            height: 90%;
            max-width: 1200px;
            max-height: 800px;
        }

        /* Estilos base para las provincias y comarcas */
        .province-path {
            fill: rgba(230, 243, 238, 0.8);
            stroke: #0F5B55;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .province-path:hover {
            fill: #8DBB66;
            stroke: #2C8AC6;
            stroke-width: 3;
            transform: scale(1.8);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
            z-index: 10;
        }

        .comarca-path {
            fill: rgba(255, 116, 102, 0.8);
            stroke: #0F5B55;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .comarca-path:hover {
            fill: #FF7466;
            stroke: #2C8AC6;
            stroke-width: 3;
            transform: scale(1.8);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
            z-index: 10;
        }

        /* Contenido dentro de las provincias expandidas */
        .province-content {
            opacity: 0;
            transition: opacity 0.4s ease 0.2s;
            pointer-events: none;
        }

        .province-path:hover .province-content {
            opacity: 1;
        }

        .comarca-path:hover .province-content {
            opacity: 1;
        }

        /* Estilos para el contenido interno */
        .content-group {
            transform-origin: center;
            transform: scale(0.6);
            transition: transform 0.4s ease 0.2s;
        }

        .province-path:hover .content-group {
            transform: scale(1);
        }

        .comarca-path:hover .content-group {
            transform: scale(1);
        }

        /* Logo/√≠cono de la provincia */
        .province-logo {
            font-size: 24px;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* T√≠tulo de la provincia */
        .province-title {
            font-family: 'DM Serif Display', serif;
            font-size: 16px;
            font-weight: 700;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* Subt√≠tulo */
        .province-subtitle {
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: rgba(255, 255, 255, 0.9);
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
        }

        /* Descripci√≥n */
        .province-description {
            font-size: 11px;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: rgba(255, 255, 255, 0.8);
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
        }

        /* Highlights */
        .province-highlights {
            font-size: 10px;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: rgba(255, 255, 255, 0.7);
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
        }

        /* Bot√≥n de explorar */
        .explore-button {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            cursor: pointer;
        }

        .explore-button:hover {
            fill: #2C8AC6;
        }

        /* T√≠tulo flotante */
        .floating-title {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 4;
            text-align: center;
            color: white;
            pointer-events: none;
        }

        .floating-title h1 {
            font-family: 'DM Serif Display', serif;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        .floating-title p {
            font-size: 1.2rem;
            opacity: 0.9;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Bot√≥n de navegaci√≥n */
        .nav-button {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 4;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .floating-title h1 {
                font-size: 2rem;
            }
            
            .floating-title p {
                font-size: 1rem;
            }
            
            .nav-button {
                top: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .province-path:hover,
            .comarca-path:hover {
                transform: scale(1.4);
            }
        }

        /* Animaciones de entrada */
        .province-path, .comarca-path {
            animation: fadeInScale 0.8s ease-out forwards;
            opacity: 0;
            transform: scale(0.8);
        }

        @keyframes fadeInScale {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Delay escalonado para las animaciones */
        .province-path:nth-child(1) { animation-delay: 0.1s; }
        .province-path:nth-child(2) { animation-delay: 0.2s; }
        .province-path:nth-child(3) { animation-delay: 0.3s; }
        .province-path:nth-child(4) { animation-delay: 0.4s; }
        .province-path:nth-child(5) { animation-delay: 0.5s; }
        .province-path:nth-child(6) { animation-delay: 0.6s; }
        .province-path:nth-child(7) { animation-delay: 0.7s; }
        .province-path:nth-child(8) { animation-delay: 0.8s; }
        .province-path:nth-child(9) { animation-delay: 0.9s; }
        .province-path:nth-child(10) { animation-delay: 1.0s; }
        .comarca-path:nth-child(1) { animation-delay: 1.1s; }
        .comarca-path:nth-child(2) { animation-delay: 1.2s; }
        .comarca-path:nth-child(3) { animation-delay: 1.3s; }
    </style>
</head>
<body>
    <!-- Mapa a pantalla completa -->
    <div class="fullscreen-map">
        <div class="map-container">
            <svg class="map-svg" viewBox="0 0 1000 400" id="panamaMap">
                <!-- El mapa SVG se generar√° din√°micamente -->
            </svg>
        </div>
    </div>

    <!-- T√≠tulo flotante -->
    <div class="floating-title">
        <h1>üó∫Ô∏è Panam√° Completo</h1>
        <p>Haz hover sobre cualquier regi√≥n para verla expandirse</p>
    </div>

    <!-- Bot√≥n de navegaci√≥n -->
    <a href="panama.html" class="nav-button" title="Volver a vista normal">‚Üê</a>

    <script>
        // Datos de las provincias y comarcas
        const regionData = {
            'bocas-del-toro': {
                name: 'Bocas del Toro',
                type: 'provincia',
                logo: 'üèùÔ∏è',
                description: 'Las Gal√°pagos del Siglo XXI',
                highlights: 'Archipi√©lago √∫nico ‚Ä¢ Biodiversidad excepcional ‚Ä¢ Cultura afrocaribe√±a'
            },
            'chiriqui': {
                name: 'Chiriqu√≠',
                type: 'provincia',
                logo: 'üèîÔ∏è',
                description: 'La Suiza de Panam√°',
                highlights: 'Volc√°n Bar√∫ ‚Ä¢ Caf√© de altura ‚Ä¢ Bosques nubosos'
            },
            'cocle': {
                name: 'Cocl√©',
                type: 'provincia',
                logo: 'üèñÔ∏è',
                description: 'Coraz√≥n de Panam√°',
                highlights: 'Carnaval tradicional ‚Ä¢ Playas del Pac√≠fico ‚Ä¢ Cordillera Central'
            },
            'colon': {
                name: 'Col√≥n',
                type: 'provincia',
                logo: 'üö¢',
                description: 'Puerta del Caribe',
                highlights: 'Fortificaciones coloniales ‚Ä¢ Zona Libre ‚Ä¢ Islas caribe√±as'
            },
            'darien': {
                name: 'Dari√©n',
                type: 'provincia',
                logo: 'üåø',
                description: 'Selva Virgen',
                highlights: 'Selva virgen ‚Ä¢ Comunidades ind√≠genas ‚Ä¢ Biodiversidad √∫nica'
            },
            'herrera': {
                name: 'Herrera',
                type: 'provincia',
                logo: 'üåæ',
                description: 'Coraz√≥n de Azuero',
                highlights: 'Folclor tradicional ‚Ä¢ Artesan√≠as ‚Ä¢ Tradici√≥n ganadera'
            },
            'los-santos': {
                name: 'Los Santos',
                type: 'provincia',
                logo: 'üé≠',
                description: 'Cuna del Folclor',
                highlights: 'Festival de la Mejorana ‚Ä¢ Playas del Pac√≠fico ‚Ä¢ Folclor aut√©ntico'
            },
            'panama': {
                name: 'Panam√°',
                type: 'provincia',
                logo: 'üèôÔ∏è',
                description: 'Capital del Pa√≠s',
                highlights: 'Canal de Panam√° ‚Ä¢ Casco Antiguo ‚Ä¢ Vida urbana'
            },
            'panama-oeste': {
                name: 'Panam√° Oeste',
                type: 'provincia',
                logo: 'üåä',
                description: 'Nueva Provincia',
                highlights: 'Playas del Pac√≠fico ‚Ä¢ Desarrollo urbano ‚Ä¢ Acceso al mar'
            },
            'veraguas': {
                name: 'Veraguas',
                type: 'provincia',
                logo: 'üåä',
                description: 'Dos Mares',
                highlights: 'Caribe y Pac√≠fico ‚Ä¢ Historia colonial ‚Ä¢ Paisajes naturales'
            },
            'guna-yala': {
                name: 'Guna Yala',
                type: 'comarca',
                logo: 'üèùÔ∏è',
                description: '365 Islas',
                highlights: 'Islas caribe√±as ‚Ä¢ Molas tradicionales ‚Ä¢ Aguas cristalinas'
            },
            'embera-wounaan': {
                name: 'Ember√°-Wounaan',
                type: 'comarca',
                logo: 'üåø',
                description: 'Selva del Dari√©n',
                highlights: 'Selva tropical ‚Ä¢ Artesan√≠as en madera ‚Ä¢ Tradiciones ancestrales'
            },
            'ngabe-bugle': {
                name: 'Ng√§be-Bugl√©',
                type: 'comarca',
                logo: 'üèîÔ∏è',
                description: 'Tierras Altas',
                highlights: 'Tierras altas ‚Ä¢ Cultivo de caf√© ‚Ä¢ Tradiciones vivas'
            }
        };

        // Funci√≥n para cargar y renderizar el mapa GeoJSON
        async function loadPanamaMap() {
            try {
                const response = await fetch('./data/geoBoundaries-PAN-ADM1.geojson');
                const geo = await response.json();
                renderMap(geo);
            } catch (error) {
                console.error('Error cargando GeoJSON:', error);
            }
        }

        // Funci√≥n para renderizar el mapa
        function renderMap(geo) {
            const container = document.getElementById('panamaMap');
            container.innerHTML = '';

            // Calcular bounds
            let minLon = Infinity, minLat = Infinity, maxLon = -Infinity, maxLat = -Infinity;

            function scanCoords(coords) {
                for (const poly of coords) {
                    const rings = Array.isArray(poly[0][0]) ? poly : [poly];
                    for (const ring of rings) {
                        for (const pt of ring) {
                            const [lon, lat] = pt;
                            if (lon < minLon) minLon = lon;
                            if (lon > maxLon) maxLon = lon;
                            if (lat < minLat) minLat = lat;
                            if (lat > maxLat) maxLat = lat;
                        }
                    }
                }
            }

            for (const f of geo.features) {
                const g = f.geometry;
                if (!g) continue;
                if (g.type === 'Polygon') scanCoords([g.coordinates]);
                if (g.type === 'MultiPolygon') scanCoords(g.coordinates);
            }

            const viewW = 1000, viewH = 400;
            function project([lon, lat]) {
                const x = (lon - minLon) / (maxLon - minLon) * viewW;
                const y = (maxLat - lat) / (maxLat - minLat) * viewH;
                return [x, y];
            }

            function pathFromPolygon(coords) {
                let d = '';
                for (const ring of coords) {
                    const [startX, startY] = project(ring[0]);
                    d += `M ${startX} ${startY}`;
                    for (let i = 1; i < ring.length; i++) {
                        const [x, y] = project(ring[i]);
                        d += ` L ${x} ${y}`;
                    }
                    d += ' Z ';
                }
                return d.trim();
            }

            geo.features.forEach((f, idx) => {
                const g = f.geometry;
                let d = '';
                if (g.type === 'Polygon') {
                    d = pathFromPolygon(g.coordinates);
                } else if (g.type === 'MultiPolygon') {
                    d = g.coordinates.map(poly => pathFromPolygon(poly)).join(' ');
                } else {
                    return;
                }

                const name = f.properties.shapeName || `Regi√≥n ${idx + 1}`;
                const normalizedName = normalizeName(name);
                const isComarca = name.includes('Comarca');
                const region = regionData[normalizedName];

                // Crear grupo para la provincia
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // Crear el path de la provincia
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', d);
                path.setAttribute('class', isComarca ? 'comarca-path' : 'province-path');
                path.setAttribute('data-region', normalizedName);

                // Calcular el centro de la provincia para posicionar el contenido
                const bounds = calculateBounds(g);
                const centerX = (bounds.minX + bounds.maxX) / 2;
                const centerY = (bounds.minY + bounds.maxY) / 2;

                // Crear el contenido interno
                const contentGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                contentGroup.setAttribute('class', 'content-group');

                if (region) {
                    // Logo
                    const logo = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    logo.setAttribute('class', 'province-logo');
                    logo.setAttribute('x', centerX);
                    logo.setAttribute('y', centerY - 30);
                    logo.textContent = region.logo;

                    // T√≠tulo
                    const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    title.setAttribute('class', 'province-title');
                    title.setAttribute('x', centerX);
                    title.setAttribute('y', centerY - 5);
                    title.textContent = region.name;

                    // Subt√≠tulo
                    const subtitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    subtitle.setAttribute('class', 'province-subtitle');
                    subtitle.setAttribute('x', centerX);
                    subtitle.setAttribute('y', centerY + 15);
                    subtitle.textContent = region.description;

                    // Descripci√≥n
                    const description = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    description.setAttribute('class', 'province-description');
                    description.setAttribute('x', centerX);
                    description.setAttribute('y', centerY + 35);
                    description.textContent = region.type === 'comarca' ? 'Comarca Ind√≠gena' : 'Provincia';

                    // Highlights
                    const highlights = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    highlights.setAttribute('class', 'province-highlights');
                    highlights.setAttribute('x', centerX);
                    highlights.setAttribute('y', centerY + 55);
                    highlights.textContent = region.highlights;

                    // Bot√≥n de explorar
                    const exploreButton = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    exploreButton.setAttribute('class', 'explore-button');
                    exploreButton.setAttribute('x', centerX);
                    exploreButton.setAttribute('y', centerY + 80);
                    exploreButton.textContent = 'EXPLORAR ‚Üí';

                    // Agregar eventos al bot√≥n
                    exploreButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        window.location.href = `panama/${normalizedName}.html`;
                    });

                    contentGroup.appendChild(logo);
                    contentGroup.appendChild(title);
                    contentGroup.appendChild(subtitle);
                    contentGroup.appendChild(description);
                    contentGroup.appendChild(highlights);
                    contentGroup.appendChild(exploreButton);
                }

                // Agregar el contenido al grupo
                const contentWrapper = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                contentWrapper.setAttribute('class', 'province-content');
                contentWrapper.appendChild(contentGroup);

                // Agregar todo al grupo principal
                group.appendChild(path);
                group.appendChild(contentWrapper);

                // Evento de click en la provincia
                path.addEventListener('click', () => {
                    window.location.href = `panama/${normalizedName}.html`;
                });

                container.appendChild(group);
            });
        }

        // Funci√≥n para calcular bounds de una geometr√≠a
        function calculateBounds(geometry) {
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;

            function scanCoords(coords) {
                for (const poly of coords) {
                    const rings = Array.isArray(poly[0][0]) ? poly : [poly];
                    for (const ring of rings) {
                        for (const pt of ring) {
                            const [x, y] = pt;
                            if (x < minX) minX = x;
                            if (x > maxX) maxX = x;
                            if (y < minY) minY = y;
                            if (y > maxY) maxY = y;
                        }
                    }
                }
            }

            if (geometry.type === 'Polygon') {
                scanCoords([geometry.coordinates]);
            } else if (geometry.type === 'MultiPolygon') {
                scanCoords(geometry.coordinates);
            }

            return { minX, minY, maxX, maxY };
        }

        // Funci√≥n para normalizar nombres
        function normalizeName(name) {
            const nameMap = {
                'Provincia de Bocas del Toro': 'bocas-del-toro',
                'Col√≥n Province': 'colon',
                'Provincia de Dari√©n': 'darien',
                'Comarca Ember√°-Wounaan': 'embera-wounaan',
                'Comarca Guna Yala': 'guna-yala',
                'Provincia de Herrera': 'herrera',
                'Provincia de Los Santos': 'los-santos',
                'Comarca Ng√§be-Bugl√©': 'ngabe-bugle',
                'Provincia de Panam√°': 'panama',
                'Provincia de Panam√° Oeste': 'panama-oeste',
                'Provincia de Veraguas': 'veraguas',
                'Provincia de Chiriqu√≠': 'chiriqui',
                'Provincia de Cocl√©': 'cocle'
            };
            
            return nameMap[name] || name.toLowerCase().replace(/\s+/g, '-');
        }

        // Cargar el mapa cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', loadPanamaMap);
    </script>
</body>
</html>
