<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa Interactivo de Panam√° - Local From Bocas</title>
  <style>
    :root{
      --island-sand: #F2E9DC;
      --jungle-teal: #0F5B55;
      --palm-leaf: #8DBB66;
      --seafoam: #E6F3EE;
      --sunset-coral: #FF7466;
      --ocean-blue: #2C8AC6;
      --cacao-brown: #5B4B3F;
    }

    html, body { 
      height: 100%; 
      margin: 0; 
      background: var(--island-sand); 
      color: var(--cacao-brown); 
      font: 15px/1.4 'Inter', system-ui, sans-serif; 
    }

    .wrap { 
      max-width: 1200px; 
      margin: 24px auto; 
      padding: 16px; 
    }

    h1 { 
      font-size: 28px; 
      margin: 0 0 10px; 
      color: var(--jungle-teal);
      font-family: 'DM Serif Display', serif;
    }
    
    p { 
      margin: 0 0 16px; 
      color: var(--cacao-brown); 
      font-size: 16px;
    }

    .map-card { 
      background: white; 
      border: 2px solid var(--jungle-teal); 
      border-radius: 16px; 
      box-shadow: 0 10px 30px rgba(0,0,0,.3); 
      padding: 20px; 
    }

    .map-frame { 
      position: relative; 
      width: 100%; 
      aspect-ratio: 5 / 2; 
      background: var(--seafoam); 
      border-radius: 12px; 
      overflow: hidden; 
    }

    svg { 
      display: block; 
      width: 100%; 
      height: 100%; 
    }

    .province { 
      fill: var(--seafoam); 
      stroke: var(--jungle-teal); 
      stroke-width: 2; 
      cursor: pointer; 
      transition: all 0.15s ease;
    }

    .province:hover { 
      fill: var(--palm-leaf); 
      transform: scale(1.02);
    }

    .comarca { 
      fill: var(--sunset-coral); 
      opacity: 0.8;
    }

    .comarca:hover { 
      fill: var(--sunset-coral); 
      opacity: 1;
      transform: scale(1.02);
    }

    .tooltip { 
      position: absolute; 
      pointer-events: none; 
      background: var(--jungle-teal); 
      color: white; 
      padding: 12px 16px; 
      border-radius: 10px; 
      font-size: 14px; 
      opacity: 0; 
      transition: opacity 0.12s ease;
    }
    
    .tooltip.show { opacity: 1; }
    
    .tooltip h3 { 
      margin: 0 0 6px; 
      font-size: 16px; 
      color: white;
    }
    
    .tooltip p { 
      margin: 0; 
      color: var(--seafoam); 
      font-size: 13px; 
    }

    .legend { 
      display: flex; 
      gap: 15px; 
      align-items: center; 
      margin-top: 16px; 
      color: var(--cacao-brown); 
      font-size: 14px; 
    }
    
    .chip { 
      width: 16px; 
      height: 16px; 
      border-radius: 4px; 
      display: inline-block; 
      border: 1px solid var(--jungle-teal);
    }
    
    .chip.land { background: var(--seafoam); }
    .chip.comarca { background: var(--sunset-coral); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üó∫Ô∏è Mapa Interactivo de Panam√°</h1>
    <p>Explora las <strong>10 provincias</strong> y <strong>3 comarcas ind√≠genas</strong> de Panam√°. Haz hover sobre una regi√≥n para ver informaci√≥n detallada.</p>

    <div class="map-card">
      <div class="map-frame" id="mapFrame">
        <svg viewBox="0 0 1000 400" role="img" aria-label="Mapa de Panam√°">
          <g id="provinces"></g>
        </svg>

        <div id="tooltip" class="tooltip">
          <h3 id="tt-name">‚Äî</h3>
          <p id="tt-info">‚Äî</p>
        </div>
      </div>

      <div class="legend">
        <span class="chip land"></span> Provincias
        <span class="chip comarca"></span> Comarcas Ind√≠genas
      </div>
    </div>
  </div>

  <script>
    const frame = document.getElementById('mapFrame');
    const tooltip = document.getElementById('tooltip');
    const ttName = document.getElementById('tt-name');
    const ttInfo = document.getElementById('tt-info');

    function showTooltip(evt, el){
      const name = el.getAttribute('data-name') || 'Regi√≥n';
      const info = el.getAttribute('data-info') || '';
      
      ttName.textContent = name;
      ttInfo.textContent = info;

      const rect = frame.getBoundingClientRect();
      const x = evt.clientX - rect.left;
      const y = evt.clientY - rect.top;
      tooltip.style.left = `${x}px`;
      tooltip.style.top = `${y}px`;
      tooltip.classList.add('show');
    }

    function hideTooltip(){
      tooltip.classList.remove('show');
    }

    function addInteractivity(el) {
      el.addEventListener('mouseenter', (e)=> showTooltip(e, el));
      el.addEventListener('mouseleave', ()=> hideTooltip());
      el.addEventListener('click', (e)=> { 
        const province = el.getAttribute('data-province');
        if (province) {
          window.location.href = `panama/${province}.html`;
        }
      });
    }

    function drawFromGeoJSON(geo){
      if(!geo || !geo.features) return;

      const group = document.getElementById('provinces');
      group.innerHTML = '';

      let minLon=Infinity, minLat=Infinity, maxLon=-Infinity, maxLat=-Infinity;

      function scanCoords(coords){
        for(const poly of coords){ 
          const rings = Array.isArray(poly[0][0]) ? poly : [poly];
          for(const ring of rings){
            for(const pt of ring){
              const [lon, lat] = pt;
              if(lon < minLon) minLon = lon; if(lon > maxLon) maxLon = lon;
              if(lat < minLat) minLat = lat; if(lat > maxLat) maxLat = lat;
            }
          }
        }
      }

      for(const f of geo.features){
        const g = f.geometry;
        if(!g) continue;
        if(g.type === 'Polygon') scanCoords([g.coordinates]);
        if(g.type === 'MultiPolygon') scanCoords(g.coordinates);
      }

      const viewW = 1000, viewH = 400;
      function project([lon, lat]){
        const x = (lon - minLon) / (maxLon - minLon) * viewW;
        const y = (maxLat - lat) / (maxLat - minLat) * viewH;
        return [x, y];
      }

      function pathFromPolygon(coords){
        let d = '';
        for(const ring of coords){
          const [startX, startY] = project(ring[0]);
          d += `M ${startX} ${startY}`;
          for(let i=1;i<ring.length;i++){
            const [x, y] = project(ring[i]);
            d += ` L ${x} ${y}`;
          }
          d += ' Z ';
        }
        return d.trim();
      }

      geo.features.forEach((f, idx)=>{
        const g = f.geometry;
        let d = '';
        if(g.type === 'Polygon'){
          d = pathFromPolygon(g.coordinates);
        } else if(g.type === 'MultiPolygon'){
          d = g.coordinates.map(poly => pathFromPolygon(poly)).join(' ');
        } else {
          return;
        }

        const name = f.properties.shapeName || `Regi√≥n ${idx+1}`;
        const info = f.properties.shapeISO || '';
        const isComarca = name.includes('Comarca');
        const normalizedName = normalizeName(name);

        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', d);
        path.setAttribute('class', isComarca ? 'province comarca' : 'province');
        path.setAttribute('data-name', name);
        path.setAttribute('data-info', info);
        path.setAttribute('data-province', normalizedName);

        group.appendChild(path);
        addInteractivity(path);
      });
    }

    function normalizeName(name) {
      const nameMap = {
        'Provincia de Bocas del Toro': 'bocas-del-toro',
        'Col√≥n Province': 'colon',
        'Provincia de Dari√©n': 'darien',
        'Comarca Ember√°-Wounaan': 'embera-wounaan',
        'Comarca Guna Yala': 'guna-yala',
        'Provincia de Herrera': 'herrera',
        'Provincia de Los Santos': 'los-santos',
        'Comarca Ng√§be-Bugl√©': 'ngabe-bugle',
        'Provincia de Panam√°': 'panama',
        'Provincia de Panam√° Oeste': 'panama-oeste',
        'Provincia de Veraguas': 'veraguas',
        'Provincia de Chiriqu√≠': 'chiriqui',
        'Provincia de Cocl√©': 'cocle'
      };
      
      return nameMap[name] || name.toLowerCase().replace(/\s+/g, '-');
    }

    async function loadPanamaGeoJSON() {
      try {
        const response = await fetch('./data/geoBoundaries-PAN-ADM1.geojson');
        const geo = await response.json();
        drawFromGeoJSON(geo);
      } catch (error) {
        console.error('Error cargando GeoJSON:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', loadPanamaGeoJSON);
  </script>
</body>
</html>
